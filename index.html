<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éŸ“æ–‡æœ—è®€æ¸¬è©¦ç‰ˆ</title>
  <style>
    body { background: #fff0f5; font-family: Arial; padding: 2rem; text-align:center; }
    h1 { color: #d26fa0; }
    button {
      background: #ffc0cb; border: none; padding: 8px 16px;
      border-radius: 10px; margin: 8px; cursor: pointer;
    }
    button:hover { background: #ffa7bd; }
  </style>
</head>
<body>
  <h1>ğŸ”Š éŸ“æ–‡æœ—è®€æ¸¬è©¦ç‰ˆ</h1>

  <div style="margin:1rem 0;">
    <button id="unlockTTS">ğŸ”“ å•Ÿå‹•èªéŸ³ï¼ˆiPhone è«‹å…ˆé»æˆ‘ä¸€æ¬¡ï¼‰</button>
  </div>

  <div>
    <button onclick="speak('ì €')">æœ—è®€ï¼šì €</button>
    <button onclick="speak('ë‹¹ì‹ ì€ ì„ ìƒë‹˜ì…ë‹ˆê¹Œ?')">æœ—è®€ï¼šë‹¹ì‹ ì€ ì„ ìƒë‹˜ì…ë‹ˆê¹Œ?</button>
    <button onclick="speak('ì €ëŠ” í•œêµ­ ì‚¬ëŒì…ë‹ˆë‹¤.')">æœ—è®€ï¼šì €ëŠ” í•œêµ­ ì‚¬ëŒì…ë‹ˆë‹¤.</button>
  </div>

  <script>
    let koVoice = null;
    let speechReady = false;

    function loadVoices() {
      const voices = speechSynthesis.getVoices?.() || [];
      koVoice = voices.find(v => (v.lang||'').toLowerCase().startsWith('ko'))
            || voices.find(v => (v.name||'').toLowerCase().includes('korean'))
            || null;
    }
    if ('speechSynthesis' in window) {
      loadVoices();
      speechSynthesis.onvoiceschanged = loadVoices;
    }

    function ensureResume() {
      try { speechSynthesis.resume(); } catch(e) {}
    }

    function unlockSpeech() {
      if (!('speechSynthesis' in window)) {
        alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æœ—è®€'); return;
      }
      speechSynthesis.cancel();
      ensureResume();
      const u = new SpeechSynthesisUtterance('ì‹œì‘');
      u.lang = 'ko-KR';
      if (koVoice) u.voice = koVoice;
      u.volume = 0; // éœéŸ³è§¸ç™¼
      u.onend = () => {
        speechReady = true;
        const btn = document.getElementById('unlockTTS');
        if (btn) {
          btn.textContent = 'âœ… èªéŸ³å·²å•Ÿå‹•ï¼ˆå¯ä»¥æ’­æ”¾ï¼‰';
          btn.disabled = true;
          btn.style.opacity = 0.7;
        }
      };
      speechSynthesis.speak(u);
    }

    function speak(text) {
      if (!('speechSynthesis' in window)) {
        alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æœ—è®€'); return;
      }
      if (!speechReady && /iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        alert('è«‹å…ˆé»ã€Œå•Ÿå‹•èªéŸ³ã€å†æ’­æ”¾'); return;
      }
      speechSynthesis.cancel();
      ensureResume();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ko-KR';
      if (koVoice) u.voice = koVoice;
      u.rate = 0.95;
      u.pitch = 1.0;
      speechSynthesis.speak(u);
    }

    document.getElementById('unlockTTS')?.addEventListener('click', unlockSpeech);
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') ensureResume();
    });
    window.speak = speak;
  </script>
</body>
</html>

